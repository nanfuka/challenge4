<html>

<head>
    <title>
        Epic-mail
    </title>
    <link rel="stylesheet" href="../css/style.css">
</head>

<body>
    <div class="background">
        <div class="header">
            <div>
                    <h1 class = "blue">Epic</h1>
                <!-- <img src="../images/logo.jpg" alt="logo" style="width:10%;height:10%;"> -->
            </div>
            <div>
                <h1>MAIL</h1>
            </div>
            <div class="left-header">
                    <p><a href = "../index.html">Home</p></a>
                    <p><a href = "signin.html">Logout</p></a>
            </div>

        </div>
        <div class="row1">
            
            <!-- <p>kalungi2k6@gm.com</p> -->

        </div>
        <div class=row2>
            
            <!-- <a href = "compose.html"><button>compose</button></a> -->
            <!-- <button>send</button>
            <button>save Draft</button>
            <button>discard</button>
            <button><a href = "compose.html" class = "active-pageS">compose</a></button> -->
        </div>

        <!-- {"subject": "jhghhjgfhjgh",
        "message":"an5y6u789ipoiuy",
        "status":"sent",
        "reciever_id":1
        } -->
        <div id = "positiveresponse"></div>
        <div id = "negativeresponse"></div>

        <div class="colrow">
            <div class="colmn1">
                <a href="user_dash.html" id = "inboxnumber">inbox(2)</a>
                <a href="draft.html">draft(2)</a>
                <a href="sent.html">sent(2)</a>
            </div>
            <div class="main-body">
                <div class="compose-row1">
                        <p>To: <input type = "text" id = "reciever_email"></p>

                </div>
                <div class="compose-row2">
                        <p>Subject: <input type = "text" id = "subject"></p>

                </div>
                <div class="compose-row2">
                        <p>status: <input type = "text" id = "status"></p>

                </div>
                <div class="compose-row3">
                        <p>Content: <input type = "text" id = "message"></p>
                

            
                <div class = "row-last">
                        <button id = "send">send</button>
                        <button>save Draft</button>
                        <button>discard</button>
             
                    </div>
            </div>
        </div>
    </div>

</body>
<script>
document.getElementById('send').addEventListener('click', Compose);

const postUrl = 'http://127.0.0.1:5000/api/v2/message';

function Compose(e){
    e.preventDefault();
    token = localStorage.getItem('token');
    if (token === null) {
        alert('You must log in');

    };
    
    let reciever_email = document.getElementById('reciever_email').value;
    let subject = document.getElementById('subject').value;
    let message = document.getElementById('message').value;
    let status = document.getElementById('status').value;
    let data = {
        reciever_email: reciever_email,
        subject: subject,
        message: message,
        status: status
    }


    fetch(postUrl, {
        method: 'POST',
        // mode: 'cors',
        headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
    })
    .then(res => res.json())
    .then(response => {
        console.log(response);
        if (response.message === 'you have successfully created a message'){
            document.getElementById("positiveresponse").innerHTML = "message sent"
            // window.location.replace('/UI/html/signin.html');
        } else {
            document.getElementById("negativeresponse").innerHTML = response.error
            // alert(response.message);
        }
    })
    .catch(err => console.log(err));
}

// function getInbox() {
//     let inbox = 'http://127.0.0.1:5000/api/v2/messages';
//     token = localStorage.getItem('token');
//     if (token === null) {
//         alert('You must log in');
//         window.location.replace('UI/index.html');
//     };
//     fetch(inbox, {
//         headers: {
//             'Authorization': `Bearer ${token}`
//         } 
//     })
//     .then(res => res.json())
//     .then(response =>

//         console.log(response.number)
//         // document.getElementById('inboxnumber').innerHTML = response.number;
//     ) 

</script>

</html>
