<html>

<head>
    <title>
        Epic-mail
    </title>
</head>

<link rel="stylesheet" href="../css/style.css">
</head>

<body>
    <div class="background">
        <div class="header">
            <div>
                <h1 class="blue">Epic</h1>
            </div>
            <div>
                <h1>MAIL</h1>
                <div class="dropdown">
                    <button class="dropbtn">Menu</button>
                    <div class="dropdown-content">
                        <a href="#">send</a>
                        <a href="#">save draft</a>
                        <a href="#">discard</a>
                        <a href="#">compose</a>
                    </div>
                </div>
            </div>
            <div class="left-header">
                <p><a href="../index.html">Home</p></a>
                <p><a href="signin.html">Logout</p></a>
            </div>

        </div>
        <div class="row1">


            <!-- <div id="to"></div> -->

        </div>
        <div class=row2>
                <button><a href="sent.html">sent</button></a>
                <button><a href="user_dash.html">inbox</a></button>
                <button><a href="compose.html">compose</a></button>
                <button><a href="admin.html" >create a group</a></button>
                <button><a href="view_groups.html">view all groups created</a></button>
        </div>
        <div id="info"></div>

        <div class="colrow">
        
            <div class="main-body">
                <div class="compose-row11">
                    <div>From: </div>
                    <div id="from"></div>

                </div>
                <div class="compose-row2">
                    <div><b>To:</b> </div>
                    <div id="to"></div>

                </div>
                <div class="compose-row3">

                    <div><b>Subject:</b> </div>
                    <div id="subject"></div>
                </div>

                <div class="compose-message">

                    <div><b>Message:</b> </div>
                    <div id="message"></div>
                </div>
              
            </div>

                    
                        <button id = "send">send</button>


                    
                </div>
            </div>
        </div>

</body>
<script>
    window.onload = function () {
        let current_url = location.href
        let url = new URL(current_url)
        let message_id = url.searchParams.get('id')
        readMessage(message_id)
        r = document.getElementById('receiver-addr')

    }

    function readMessage(id) {
        let readmsgUrl = `http://127.0.0.1:5000/api/v2/messages/${id}`;
        token = localStorage.getItem('token');
        fetch(readmsgUrl, {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            })
            .then(res => res.json())
            .then(response => {
                // alert(response)
                // .then(response => {
                if (response.error === "you have no recieved messages") {
                    // console.log(response)
                    document.getElementById('no_mail').innerHTML = response.error;
                } else if (response.status == 200) {
                    var d = response.data;
                    console.log(d)
                    let result = ``;
                    let email = ``;
                    d.forEach((msg) => {

                        document.getElementById("from").innerHTML = `${msg.sender_email}`;
                        document.getElementById("to").innerHTML = `${msg.reciever_email}`;
                        document.getElementById("message").innerHTML = `${msg.message}`;
                        document.getElementById("subject").innerHTML = `${msg.subject}`;
                       

                        document.getElementById('info').innerHTML = result;
                       
                    });
                }
            })
    }

   